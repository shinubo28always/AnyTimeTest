<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Metadata Editor - Working Version</title>
<!-- ‡¶è‡¶á ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶Æ‡ßá‡¶ü‡¶æ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó Cross-Origin Isolation ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá, ‡¶Ø‡¶¶‡¶ø‡¶ì ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡¶á ‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® -->
<meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin" />
<meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp" />
<style>
  body { background: #0d0d0d; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; text-align: center; }
  h1 { margin-bottom: 20px; color: #00eaff; }
  .container { background: #1a1a1a; padding: 20px; border-radius: 12px; max-width: 450px; margin: auto; box-shadow: 0 4px 15px rgba(0, 234, 255, 0.1); }
  input, button { width: 95%; padding: 12px; margin: 8px 0; font-size: 16px; border-radius: 6px; border: 1px solid #333; background: #222; color: #fff; }
  input::placeholder { color: #888; }
  input[type="file"] { padding: 10px; background: #333; }
  button { background: #00eaff; color: #000; cursor: pointer; font-weight: bold; border: none; transition: background 0.3s; }
  button:hover:not(:disabled) { background: #00c4d4; }
  button:disabled { background: #555; cursor: not-allowed; }
  #statusBox, #logBox { background: #111; padding: 15px; margin-top: 20px; border-radius: 10px; text-align: left; font-size: 14px; border: 1px solid #222; }
  #logBox { height: 150px; overflow-y: auto; font-family: 'Courier New', Courier, monospace; line-height: 1.5; }
  #progressBarContainer { height: 10px; background: #333; border-radius: 5px; margin-top: 10px; overflow: hidden; }
  #progressBar { width: 0%; height: 100%; background: #00eaff; transition: width 0.2s; }
</style>
</head>
<body>

<h1>üé¨ Video Metadata Editor</h1>

<div class="container">
  <input type="file" id="fileInput" accept="video/*">
  <input type="text" id="title" placeholder="Title (e.g., My Awesome Video)">
  <input type="text" id="author" placeholder="Author / Artist (e.g., John Doe)">
  <input type="text" id="album" placeholder="Album / Show (e.g., Holiday Clips)">
  <input type="text" id="encodedBy" placeholder="Encoded By (e.g., My Encoder)">
  <input type="text" id="comment" placeholder="Comment (e.g., 4K Remaster)">

  <button id="startBtn">Apply Metadata</button>
</div>

<div id="statusBox">
  <b>Status:</b> <span id="statusText">Waiting for FFmpeg to load...</span>
  <div id="progressBarContainer">
    <div id="progressBar"></div>
  </div>
</div>

<div id="logBox">Logs will appear here...</div>

<script type="module">
  // FFmpeg ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
  import { FFmpeg } from "https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.7/dist/esm/index.js";
  import { toBlobURL } from "https://cdn.jsdelivr.net/npm/@ffmpeg/util@0.12.1/dist/esm/index.js";

  const ffmpeg = new FFmpeg();
  const logBox = document.getElementById("logBox");
  const statusText = document.getElementById("statusText");
  const progressBar = document.getElementById("progressBar");
  const startBtn = document.getElementById("startBtn");

  // ‡¶≤‡¶ó ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  const log = (message) => {
    logBox.innerHTML += `> ${message}\n`;
    logBox.scrollTop = logBox.scrollHeight;
  };

  // FFmpeg ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  const loadFFmpeg = async () => {
    try {
      startBtn.disabled = true;
      const baseURL = "https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/esm";
      ffmpeg.on("log", ({ message }) => log(message));
      
      await ffmpeg.load({
        coreURL: await toBlobURL(`${baseURL}/ffmpeg-core.js`, "text/javascript"),
        wasmURL: await toBlobURL(`${baseURL}/ffmpeg-core.wasm`, "application/wasm"),
      });

      statusText.textContent = "Ready! Select a video and apply metadata.";
      log("FFmpeg loaded successfully!");
      startBtn.disabled = false;
    } catch (error) {
      statusText.textContent = "Failed to load FFmpeg. Check console for errors.";
      log(`Error loading FFmpeg: ${error}`);
      console.error(error);
    }
  };

  // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá‡¶á FFmpeg ‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá
  loadFFmpeg();

  // ·Éû·É†·Éù·Éí·É†‡ßá‡¶∏‡ßá·É°‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
  ffmpeg.on("progress", ({ progress }) => {
    const percent = Math.round(progress * 100);
    progressBar.style.width = `${percent}%`;
    statusText.textContent = `Processing: ${percent}%`;
  });


  // ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá
  startBtn.onclick = async () => {
    const fileInput = document.getElementById("fileInput");
    const file = fileInput.files[0];
    if (!file) {
      alert("Please select a video file first!");
      return;
    }

    startBtn.disabled = true;
    logBox.innerHTML = "Starting process...\n";
    progressBar.style.width = '0%';

    try {
      // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ
      const inName = "input." + file.name.split('.').pop();
      const outName = `output_${Date.now()}.mp4`;

      log(`Input file: ${file.name}`);
      log("Writing file to FFmpeg's virtual memory...");
      statusText.textContent = "Uploading file to memory...";
      
      // ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø‡¶ï‡ßá FFmpeg ‡¶è‡¶∞ ‡¶Æ‡ßá‡¶Æ‡¶∞‡¶ø‡¶§‡ßá ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
      await ffmpeg.writeFile(inName, new Uint8Array(await file.arrayBuffer()));
      log("File written successfully.");

      // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßá‡¶ü‡¶æ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
      const metadataArgs = [];
      const addMeta = (key, value) => {
        if (value) metadataArgs.push("-metadata", `${key}=${value}`);
      };

      addMeta("title", document.getElementById("title").value);
      addMeta("artist", document.getElementById("author").value);
      addMeta("album", document.getElementById("album").value);
      addMeta("encoded_by", document.getElementById("encodedBy").value);
      addMeta("comment", document.getElementById("comment").value);

      log("Executing FFmpeg command...");
      
      // FFmpeg ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
      await ffmpeg.exec([
        "-i", inName,
        ...metadataArgs,
        "-c", "copy", // ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶°‡¶ø‡¶ì re-encode ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá, ‡¶§‡¶æ‡¶á ‡¶ñ‡ßÅ‡¶¨ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶π‡¶¨‡ßá
        outName
      ]);

      log("Command executed. Reading output file...");
      statusText.textContent = "Finalizing...";

      // ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶Æ‡ßá‡¶Æ‡¶∞‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡ßú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
      const data = await ffmpeg.readFile(outName);
      const blob = new Blob([data.buffer], { type: "video/mp4" });
      const url = URL.createObjectURL(blob);

      // ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá ‡¶∏‡ßç‡¶¨‡ßü‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
      const a = document.createElement("a");
      a.href = url;
      a.download = outName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      log(`Processing complete! File "${outName}" downloaded.`);
      statusText.textContent = "Done! Check your downloads.";

    } catch (error) {
      log(`An error occurred: ${error}`);
      statusText.textContent = "An error occurred. Check logs for details.";
      console.error(error);
    } finally {
      // ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶è‡¶®‡¶æ‡¶¨‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
      startBtn.disabled = false;
      progressBar.style.width = '0%';
    }
  };

</script>

</body>
</html>
